<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Season Slider</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100vh;
    overflow: hidden;
  }

  body {
    --spring-opacity: 1;
    --summer-opacity: 0;
    --autumn-opacity: 0;
    --winter-opacity: 0;
    --snow-opacity: 0;
  }
  
  input[type="range"] {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  input[type="number"] {
    position: absolute;
    top: 80px;
    left: 10px;
    z-index: 1;
  }

  button {
    position: absolute;
    top: 50px;
    left: 10px;
    z-index: 1;
  }
  
  svg, img {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: translate(-50%, -50%);
  }

  .isolate {
    isolation: isolate;
  }

  #snowOverlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10;
    background-image: url('snow03.gif');
    opacity: var(--snow-opacity);
    transition: opacity 0.5s ease;
  }
</style>
</head>
<body>
<input type="range" min="0" max="9999" value="1" id="seasonSlider">
<input type="number" min="2" max="20" value="10" id="speedInput">
<button id="setAuto">Toggle automatic</button>
<div class="isolate">
  <img src="res/spring.svg" id="spring">
  <img src="res/summer.svg" id="summer">
  <img src="res/autumn.svg" id="autumn">
  <img src="res/winter.svg" id="winter">
  <div id="snowOverlay"></div>
</div>

<div id="lottieContainer" style="position: absolute; top: 10px; right: 10px; width: 200px; height: 200px;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.6/lottie.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('seasonSlider');
    let animationTime = 10;
    let isAuto = false;
    let speedInput = document.getElementById('speedInput');
    let sliderValue = 0;
    let lastTime = performance.now() / 1000;

    // Lottie animation
    const lottieContainer = document.getElementById('lottieContainer');
    const lottieAnimation = lottie.loadAnimation({
      container: lottieContainer,
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: 'res/duckAnim.json' // Replace with the path to your Lottie animation file
    });

    slider.addEventListener('input', drawImages);

    document.getElementById('setAuto').addEventListener('click', () => {
      isAuto = !isAuto;
      if (isAuto) {
        lastTime = performance.now() / 1000;
        window.requestAnimationFrame(increase);
      }
    });

    speedInput.addEventListener('input', function() {
      animationTime = speedInput.value;
    });

    function easeInOutCubic(x) {
      return x;
    }

    function increase() {
      if (!isAuto) {
        return;
      }
      let time = performance.now() / 1000;
      let dt = time - lastTime;
      lastTime = time;

      sliderValue += dt * (1 / animationTime);

      if (sliderValue >= 1) {
        sliderValue = 0;
      }

      slider.value = sliderValue * slider.max;
      drawImages();
      window.requestAnimationFrame(increase);
    }

    function drawImages() {
      let seasonIndex = slider.value / slider.max;
      let springOpacity = 0, summerOpacity = 0, autumnOpacity = 0, winterOpacity = 0;

      if (seasonIndex <= 0.25) {
        let currentSeasonIndex = easeInOutCubic(seasonIndex / 0.25);
        springOpacity = 1 - currentSeasonIndex;
        summerOpacity = currentSeasonIndex;
      } else if (seasonIndex <= 0.5) {
        let currentSeasonIndex = easeInOutCubic((seasonIndex - 0.25) / 0.25);
        summerOpacity = 1 - currentSeasonIndex;
        autumnOpacity = currentSeasonIndex;
      } else if (seasonIndex <= 0.75) {
        let currentSeasonIndex = easeInOutCubic((seasonIndex - 0.5) / 0.25);
        autumnOpacity = 1 - currentSeasonIndex;
        winterOpacity = currentSeasonIndex;
      } else {
        let currentSeasonIndex = easeInOutCubic((seasonIndex - 0.75) / 0.25);
        winterOpacity = 1 - currentSeasonIndex;
        springOpacity = currentSeasonIndex;
      }

      document.body.style.setProperty('--spring-opacity', springOpacity);
      document.body.style.setProperty('--summer-opacity', summerOpacity);
      document.body.style.setProperty('--autumn-opacity', autumnOpacity);
      document.body.style.setProperty('--winter-opacity', winterOpacity);

      document.body.style.setProperty('--snow-opacity', (seasonIndex > 0.5 && seasonIndex < 0.75) ? 1 : 0);
    }

    // Parallax effect
    document.addEventListener('mousemove', (e) => {
      let layers = document.querySelectorAll('img');
      layers.forEach((layer, index) => {
        let speed = (index + 1) / layers.length;
        let x = (window.innerWidth - e.pageX * speed) / 100;
        let y = (window.innerHeight - e.pageY * speed) / 100;
        layer.style.transform = `translate(${x}px, ${y}px)`;
      });
    });

    // SVG interactivity
    document.querySelectorAll('img').forEach(svgElement => {
      svgElement.addEventListener('click', (e) => {
        if (e.target.id === 'sun') {
          let newGradient = Math.floor(Math.random() * 360);
          e.target.style.fill = `hsl(${newGradient}, 100%, 50%)`;
        }
      });
    });
  });
</script>
</body>
</html>